<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fortnite Status Tracker</title>
  <style>
    body { font-family: sans-serif; margin: 20px; background: #f9f9f9; color: #333; }
    h1 { text-align: center; margin-bottom: 20px; }
    #searchInput { width: 100%; padding: 12px; margin-bottom: 15px; font-size: 16px; border-radius: 6px; border: 1px solid #ccc; }
    #statusList { list-style: none; padding: 0; margin: 0; }
    #statusList li { padding: 10px; margin-bottom: 8px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; transition: background 0.3s; }
    .online { background-color: #d4edda; color: #155724; }
    .degraded { background-color: #fff3cd; color: #856404; }
    .offline { background-color: #f8d7da; color: #721c24; }
    .icon { margin-right: 8px; font-size: 18px; }
    mark { background-color: #ffeeba; padding: 0; }
    #lastUpdated { margin-top: 15px; font-size: 14px; text-align: center; color: #666; }
  </style>
</head>
<body>

<h1>Fortnite Status Tracker</h1>
<input type="text" id="searchInput" placeholder="Search services…">
<ul id="statusList"></ul>
<div id="lastUpdated">Last Updated: --:--:--</div>

<script>
  const searchInput = document.getElementById('searchInput');
  const statusList = document.getElementById('statusList');
  const lastUpdated = document.getElementById('lastUpdated');
  let statusData = [];

  // Fetch status JSON
  async function fetchStatus() {
    try {
      const response = await fetch('/status.json'); // adjust path if needed
      const data = await response.json();
      statusData = data;
      renderList(statusData);
      updateTimestamp();
    } catch (err) {
      console.error('Error fetching status:', err);
    }
  }

  // Render list with color coding, icons, and highlighted search
  function renderList(data) {
    const query = searchInput.value.toLowerCase();

    // Sort by status priority: Offline > Degraded > Online
    const sortedData = data.sort((a,b) => {
      const priority = {offline: 0, degraded: 1, online: 2};
      return (priority[a.status.toLowerCase()] || 3) - (priority[b.status.toLowerCase()] || 3);
    });

    statusList.innerHTML = '';
    sortedData.forEach(item => {
      const li = document.createElement('li');

      // Determine class and icon
      let statusClass = '';
      let icon = '';
      if (item.status.toLowerCase() === 'online') { statusClass = 'online'; icon = '✔️'; }
      else if (item.status.toLowerCase() === 'degraded') { statusClass = 'degraded'; icon = '⚠️'; }
      else if (item.status.toLowerCase() === 'offline') { statusClass = 'offline'; icon = '❌'; }

      li.className = statusClass;

      // Highlight search matches
      const nameHTML = highlightText(item.name, query);
      const statusHTML = highlightText(item.status, query);

      li.innerHTML = `<span><span class="icon">${icon}</span>${nameHTML}</span><span>${statusHTML}</span>`;
      statusList.appendChild(li);
    });
  }

  // Highlight matching text
  function highlightText(text, query) {
    if (!query) return text;
    const regex = new RegExp(`(${escapeRegex(query)})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
  }

  function escapeRegex(string) {
    return string.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
  }

  // Update timestamp
  function updateTimestamp() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString();
    lastUpdated.textContent = `Last Updated: ${timeStr}`;
  }

  // Live search
  searchInput.addEventListener('keyup', () => {
    renderList(statusData);
  });

  // Auto-refresh every 30 seconds
  fetchStatus(); // initial fetch
  setInterval(fetchStatus, 30000);
</script>

</body>
</html>
